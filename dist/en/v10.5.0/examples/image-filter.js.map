{"version":3,"file":"image-filter.js","mappings":"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","sources":["webpack:///./image-filter.js"],"sourcesContent":["import Map from '../src/ol/Map.js';\nimport View from '../src/ol/View.js';\nimport TileLayer from '../src/ol/layer/Tile.js';\nimport {fromLonLat} from '../src/ol/proj.js';\nimport ImageTile from '../src/ol/source/ImageTile.js';\n\nconst key = 'get_your_own_D6rA4zTHduk6KOKTXzGB';\nconst attributions =\n  '<a href=\"https://www.maptiler.com/copyright/\" target=\"_blank\">&copy; MapTiler</a> ' +\n  '<a href=\"https://www.openstreetmap.org/copyright\" target=\"_blank\">&copy; OpenStreetMap contributors</a>';\n\nconst imagery = new TileLayer({\n  source: new ImageTile({\n    attributions: attributions,\n    url: 'https://api.maptiler.com/maps/satellite/{z}/{x}/{y}.jpg?key=' + key,\n    tileSize: 512,\n    maxZoom: 20,\n  }),\n});\n\nconst map = new Map({\n  layers: [imagery],\n  target: 'map',\n  view: new View({\n    center: fromLonLat([-120, 50]),\n    zoom: 6,\n  }),\n});\n\nconst kernels = {\n  none: [0, 0, 0, 0, 1, 0, 0, 0, 0],\n  sharpen: [0, -1, 0, -1, 5, -1, 0, -1, 0],\n  sharpenless: [0, -1, 0, -1, 10, -1, 0, -1, 0],\n  blur: [1, 1, 1, 1, 1, 1, 1, 1, 1],\n  shadow: [1, 2, 1, 0, 1, 0, -1, -2, -1],\n  emboss: [-2, 1, 0, -1, 1, 1, 0, 1, 2],\n  edge: [0, 1, 0, 1, -4, 1, 0, 1, 0],\n};\n\nfunction normalize(kernel) {\n  const len = kernel.length;\n  const normal = new Array(len);\n  let i,\n    sum = 0;\n  for (i = 0; i < len; ++i) {\n    sum += kernel[i];\n  }\n  if (sum <= 0) {\n    normal.normalized = false;\n    sum = 1;\n  } else {\n    normal.normalized = true;\n  }\n  for (i = 0; i < len; ++i) {\n    normal[i] = kernel[i] / sum;\n  }\n  return normal;\n}\n\nconst select = document.getElementById('kernel');\nlet selectedKernel = normalize(kernels[select.value]);\n\n/**\n * Update the kernel and re-render on change.\n */\nselect.onchange = function () {\n  selectedKernel = normalize(kernels[select.value]);\n  map.render();\n};\n\n/**\n * Apply a filter on \"postrender\" events.\n */\nimagery.on('postrender', function (event) {\n  convolve(event.context, selectedKernel);\n});\n\n/**\n * Apply a convolution kernel to canvas.  This works for any size kernel, but\n * performance starts degrading above 3 x 3.\n * @param {CanvasRenderingContext2D} context Canvas 2d context.\n * @param {Array<number>} kernel Kernel.\n */\nfunction convolve(context, kernel) {\n  const canvas = context.canvas;\n  const width = canvas.width;\n  const height = canvas.height;\n\n  const size = Math.sqrt(kernel.length);\n  const half = Math.floor(size / 2);\n\n  const inputData = context.getImageData(0, 0, width, height).data;\n\n  const output = context.createImageData(width, height);\n  const outputData = output.data;\n\n  for (let pixelY = 0; pixelY < height; ++pixelY) {\n    const pixelsAbove = pixelY * width;\n    for (let pixelX = 0; pixelX < width; ++pixelX) {\n      let r = 0,\n        g = 0,\n        b = 0,\n        a = 0;\n      for (let kernelY = 0; kernelY < size; ++kernelY) {\n        for (let kernelX = 0; kernelX < size; ++kernelX) {\n          const weight = kernel[kernelY * size + kernelX];\n          const neighborY = Math.min(\n            height - 1,\n            Math.max(0, pixelY + kernelY - half),\n          );\n          const neighborX = Math.min(\n            width - 1,\n            Math.max(0, pixelX + kernelX - half),\n          );\n          const inputIndex = (neighborY * width + neighborX) * 4;\n          r += inputData[inputIndex] * weight;\n          g += inputData[inputIndex + 1] * weight;\n          b += inputData[inputIndex + 2] * weight;\n          a += inputData[inputIndex + 3] * weight;\n        }\n      }\n      const outputIndex = (pixelsAbove + pixelX) * 4;\n      outputData[outputIndex] = r;\n      outputData[outputIndex + 1] = g;\n      outputData[outputIndex + 2] = b;\n      outputData[outputIndex + 3] = kernel.normalized ? a : 255;\n    }\n  }\n  context.putImageData(output, 0, 0);\n}\n"],"names":["imagery","source","attributions","url","tileSize","maxZoom","map","layers","target","view","center","zoom","kernels","none","sharpen","sharpenless","blur","shadow","emboss","edge","normalize","kernel","len","length","normal","Array","i","sum","normalized","select","document","getElementById","selectedKernel","value","onchange","render","on","event","context","canvas","width","height","size","Math","sqrt","half","floor","inputData","getImageData","data","output","createImageData","outputData","pixelY","pixelsAbove","pixelX","r","g","b","a","kernelY","kernelX","weight","inputIndex","min","max","outputIndex","putImageData","convolve"],"sourceRoot":""}