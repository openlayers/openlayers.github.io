"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[962],{65679:function(e,t,r){var s=r(41564),l=r(87240),i=r(53815),a=r(22685),o=r(16235),n=r(86630),h=r(77803),c=r(12911),f=r(9466),d=r(77163),y=r(77801),_=r(2732),g=r(84333),m=r(4666),p=r(14049);class u extends p.A{constructor(e,t){super(e),this.batch_=new g.A,this.styleRenderer_=t,this.buffers=null,this.maskVertices=new d.Ay(m.H7,m.Ek),this.setTile(e.tile)}generateMaskBuffer_(){const e=this.tile.getSourceTiles()[0].extent;this.maskVertices.fromArray([e[0],e[1],e[2],e[1],e[2],e[3],e[0],e[3]]),this.helper.flushBufferData(this.maskVertices)}uploadTile(){this.generateMaskBuffer_(),this.batch_.clear();const e=this.tile.getSourceTiles(),t=e.reduce(((e,t)=>e.concat(t.getFeatures())),[]);this.batch_.addFeatures(t);const r=e[0].extent[0],s=e[0].extent[1],l=(0,c.Tl)((0,c.vt)(),-r,-s);this.styleRenderer_.generateBuffers(this.batch_,l).then((e=>{this.buffers=e,this.setReady()}))}disposeInternal(){if(this.buffers){const e=e=>{for(const t of e)t&&this.helper.deleteBuffer(t)};this.buffers.pointBuffers&&e(this.buffers.pointBuffers),this.buffers.lineStringBuffers&&e(this.buffers.lineStringBuffers),this.buffers.polygonBuffers&&e(this.buffers.polygonBuffers)}super.disposeInternal()}}var k=u,T=r(55721);const b={...T.gF,TILE_MASK_TEXTURE:"u_depthMask",TILE_ZOOM_LEVEL:"u_tileZoomLevel"},w="a_position";class E extends T.Ay{constructor(e,t){super(e,{cacheSize:t.cacheSize,uniforms:{[b.PATTERN_ORIGIN]:[0,0],[b.TILE_MASK_TEXTURE]:()=>this.tileMaskTarget_.getTexture()}}),this.hitDetectionEnabled_=!t.disableHitDetection,this.style_=null,this.styleVariables_=t.variables||{},this.styleRenderer_=null,this.currentFrameStateTransform_=(0,c.vt)(),this.tmpTransform_=(0,c.vt)(),this.tmpMat4_=(0,f.vt)(),this.tileMaskTarget_=null,this.tileMaskIndices_=new d.Ay(m.IP,m.Ek),this.tileMaskIndices_.fromArray([0,1,3,1,2,3]),this.tileMaskAttributes_=[{name:w,size:2,type:y.jQ.FLOAT}],this.tileMaskProgram_,this.applyOptions_(t)}reset(e){super.reset(e),this.applyOptions_(e),this.helper&&(this.createRenderers_(),this.initTileMask_())}applyOptions_(e){this.style_=e.style}createRenderers_(){function e(e){const t=e.getFragmentDiscardExpression(),r=`texture2D(${b.TILE_MASK_TEXTURE}, gl_FragCoord.xy / u_pixelRatio / u_viewportSizePx).r * 50. > ${b.TILE_ZOOM_LEVEL} + 0.5`;e.setFragmentDiscardExpression("false"!==t?`(${t}) || (${r})`:r),e.addUniform(b.TILE_MASK_TEXTURE,"sampler2D"),e.addUniform(b.TILE_ZOOM_LEVEL,"float")}const t=(0,h.k2)(this.style_,this.styleVariables_);for(const r of t)e(r.builder);this.styleRenderer_=new h.Ay(t,this.styleVariables_,this.helper,this.hitDetectionEnabled_)}initTileMask_(){this.tileMaskTarget_=new _.A(this.helper);const e=(new n.N).setFillColorExpression(`vec4(${b.TILE_ZOOM_LEVEL} / 50., 0., 0., 1.)`).addUniform(b.TILE_ZOOM_LEVEL,"float");this.tileMaskProgram_=this.helper.getProgram(e.getFillFragmentShader(),e.getFillVertexShader()),this.helper.flushBufferData(this.tileMaskIndices_)}afterHelperCreated(){this.createRenderers_(),this.initTileMask_()}createTileRepresentation(e){const t=new k(e,this.styleRenderer_),r=()=>{t.ready&&(this.getLayer().changed(),t.removeEventListener(a.A.CHANGE,r))};return t.addEventListener(a.A.CHANGE,r),t}beforeTilesRender(e,t){super.beforeTilesRender(e,!0),this.helper.makeProjectionTransform(e,this.currentFrameStateTransform_)}beforeTilesMaskRender(e){this.helper.makeProjectionTransform(e,this.currentFrameStateTransform_);const t=e.pixelRatio,r=e.size;return this.tileMaskTarget_.setSize([r[0]*t,r[1]*t]),this.helper.prepareDrawToRenderTarget(e,this.tileMaskTarget_,!0,!0),this.helper.useProgram(this.tileMaskProgram_,e),(0,c.k3)(this.tmpTransform_,this.currentFrameStateTransform_),this.helper.setUniformMatrixValue(b.PROJECTION_MATRIX,(0,f.Z1)(this.tmpMat4_,this.tmpTransform_)),(0,c.T9)(this.tmpTransform_,this.currentFrameStateTransform_),this.helper.setUniformMatrixValue(b.SCREEN_TO_WORLD_MATRIX,(0,f.Z1)(this.tmpMat4_,this.tmpTransform_)),!0}renderTileMask(e,t,r,s){if(!e.ready)return;this.helper.setUniformFloatValue(b.DEPTH,s),this.helper.setUniformFloatValue(b.TILE_ZOOM_LEVEL,t),this.helper.setUniformFloatVec4(b.RENDER_EXTENT,r),this.helper.setUniformFloatValue(b.GLOBAL_ALPHA,1),this.helper.bindBuffer(e.maskVertices),this.helper.bindBuffer(this.tileMaskIndices_),this.helper.enableAttributes(this.tileMaskAttributes_);const l=this.tileMaskIndices_.getSize();this.helper.drawElements(0,l)}applyUniforms_(e,t,r,s,l){(0,c.k3)(this.tmpTransform_,this.currentFrameStateTransform_),(0,c.lw)(this.tmpTransform_,r),this.helper.setUniformMatrixValue(b.PROJECTION_MATRIX,(0,f.Z1)(this.tmpMat4_,this.tmpTransform_)),(0,c.T9)(this.tmpTransform_,this.currentFrameStateTransform_),this.helper.setUniformMatrixValue(b.SCREEN_TO_WORLD_MATRIX,(0,f.Z1)(this.tmpMat4_,this.tmpTransform_)),this.helper.setUniformFloatValue(b.GLOBAL_ALPHA,e),this.helper.setUniformFloatValue(b.DEPTH,l),this.helper.setUniformFloatValue(b.TILE_ZOOM_LEVEL,s),this.helper.setUniformFloatVec4(b.RENDER_EXTENT,t)}renderTile(e,t,r,s,l,i,a,n,h,c,f){const d=(0,o._N)(n,s,n),y=e.tile.getTileCoord()[0],_=e.buffers;_&&this.styleRenderer_.render(_,r,(()=>{this.applyUniforms_(f,d,_.invertVerticesTransform,y,h)}))}renderDeclutter(e){}disposeInternal(){super.disposeInternal()}}var M=E,L=r(880);class R extends L.A{constructor(e){super(Object.assign({},e)),this.styleVariables_=e.variables||{},this.style_=e.style,this.hitDetectionDisabled_=!!e.disableHitDetection}createRenderer(){return new M(this,{style:this.style_,variables:this.styleVariables_,disableHitDetection:this.hitDetectionDisabled_,cacheSize:this.getCacheSize()})}updateStyleVariables(e){Object.assign(this.styleVariables_,e),this.changed()}setStyle(e){this.style_=e,this.clearRenderer(),this.changed()}}var A=R,V=r(98267);new s.A({layers:[new A({source:new V.A({attributions:'© <a href="https://www.mapbox.com/map-feedback/">Mapbox</a> © <a href="https://www.openstreetmap.org/copyright">OpenStreetMap contributors</a>',format:new i.A,url:"https://{a-d}.tiles.mapbox.com/v4/mapbox.mapbox-streets-v6/{z}/{x}/{y}.vector.pbf?access_token=pk.eyJ1IjoiYWhvY2V2YXIiLCJhIjoiY2t0cGdwMHVnMGdlbzMxbDhwazBic2xrNSJ9.WbcTL9uj8JPAsnT9mgb7oQ"}),style:[{filter:["all",["==",["get","layer"],"landuse"],["==",["get","class"],"park"]],style:{"fill-color":"#d8e8c8"}},{filter:["all",["==",["get","layer"],"landuse"],["==",["get","class"],"cemetery"]],style:{"fill-color":"#e0e4dd"}},{filter:["all",["==",["get","layer"],"landuse"],["==",["get","class"],"hospital"]],style:{"fill-color":"#fde"}},{filter:["all",["==",["get","layer"],"landuse"],["==",["get","class"],"school"]],style:{"fill-color":"#f0e8f8"}},{filter:["all",["==",["get","layer"],"landuse"],["==",["get","class"],"wood"]],style:{"fill-color":"rgb(233,238,223)"}},{filter:["==",["get","layer"],"waterway"],style:{"stroke-color":"#a0c8f0","stroke-width":1}},{filter:["==",["get","layer"],"water"],style:{"fill-color":"#a0c8f0"}},{filter:["all",["==",["get","layer"],"aeroway"],["==",["geometry-type"],"Polygon"]],style:{"fill-color":"rgb(242,239,235)"}},{filter:["all",["==",["get","layer"],"aeroway"],["==",["geometry-type"],"LineString"],["<=",["resolution"],76.43702828517625]],style:{"fill-color":"#f0ede9"}},{filter:["==",["get","layer"],"building"],style:{"fill-color":"#f2eae2","stroke-color":"#dfdbd7","stroke-width":1}},{filter:["all",["==",["get","layer"],"tunnel"],["==",["get","class"],"motorway_link"]],style:{"stroke-color":"#e9ac77","stroke-width":1}},{filter:["all",["==",["get","layer"],"tunnel"],["==",["get","class"],"service"]],style:{"stroke-color":"#cfcdca","stroke-width":1}},{filter:["all",["==",["get","layer"],"tunnel"],["any",["==",["get","class"],"street"],["==",["get","class"],"street_limited"]]],style:{"stroke-color":"#cfcdca","stroke-width":1}},{filter:["all",["==",["get","layer"],"tunnel"],["==",["get","class"],"main"],["<=",["resolution"],1222.99245256282]],style:{"stroke-color":"#e9ac77","stroke-width":1}},{filter:["all",["==",["get","layer"],"tunnel"],["==",["get","class"],"motorway"]],style:{"stroke-color":"#e9ac77","stroke-width":1}},{filter:["all",["==",["get","layer"],"tunnel"],["==",["get","class"],"path"]],style:{"stroke-color":"#cba","stroke-width":1}},{filter:["all",["==",["get","layer"],"tunnel"],["==",["get","class"],"major_rail"]],style:{"stroke-color":"#bbb","stroke-width":2}},{filter:["all",["==",["get","layer"],"road"],["==",["get","class"],"motorway_link"]],style:{"stroke-color":"#e9ac77","stroke-width":1}},{filter:["all",["==",["get","layer"],"road"],["any",["==",["get","class"],"street"],["==",["get","class"],"street_limited"]],["==",["geometry-type"],"LineString"]],style:{"stroke-color":"#cfcdca","stroke-width":1}},{filter:["all",["==",["get","layer"],"road"],["==",["get","class"],"main"],["<=",["resolution"],1222.99245256282]],style:{"stroke-color":"#e9ac77","stroke-width":1}},{filter:["all",["==",["get","layer"],"road"],["==",["get","class"],"motorway"],["<=",["resolution"],4891.96981025128]],style:{"stroke-color":"#e9ac77","stroke-width":1}},{filter:["all",["==",["get","layer"],"road"],["==",["get","class"],"path"]],style:{"stroke-color":"#cba","stroke-width":1}},{filter:["all",["==",["get","layer"],"road"],["==",["get","class"],"major_rail"]],style:{"stroke-color":"#bbb","stroke-width":2}},{filter:["all",["==",["get","layer"],"bridge"],["any",["==",["get","class"],"motorway"],["==",["get","class"],"motorway_link"]]],style:{"stroke-color":"#e9ac77","stroke-width":1}},{filter:["all",["==",["get","layer"],"bridge"],["any",["==",["get","class"],"street"],["==",["get","class"],"street_limited"],["==",["get","class"],"service"]]],style:{"stroke-color":"#cfcdca","stroke-width":1}},{filter:["all",["==",["get","layer"],"bridge"],["==",["get","class"],"main"],["<=",["resolution"],1222.99245256282]],style:{"stroke-color":"#e9ac77","stroke-width":1}},{filter:["all",["==",["get","layer"],"bridge"],["==",["get","class"],"path"]],style:{"stroke-color":"#cba","stroke-width":1}},{filter:["all",["==",["get","layer"],"bridge"],["==",["get","class"],"major_rail"]],style:{"stroke-color":"#bbb","stroke-width":2}},{filter:["all",["==",["get","layer"],"admin"],[">=",["get","admin_level"],2],["==",["get","maritime"],0]],style:{"stroke-color":"#9e9cab","stroke-width":1}},{filter:["all",["==",["get","layer"],"admin"],[">=",["get","admin_level"],2],["==",["get","maritime"],1]],style:{"stroke-color":"#a0c8f0","stroke-width":1}},{style:{"circle-radius":4,"circle-fill-color":"#777"}}]})],target:"map",view:new l.Ay({center:[0,0],zoom:2})})}},function(e){var t;t=65679,e(e.s=t)}]);
//# sourceMappingURL=webgl-vector-tiles.js.map