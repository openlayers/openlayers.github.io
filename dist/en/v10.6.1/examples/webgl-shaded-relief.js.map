{"version":3,"file":"webgl-shaded-relief.js","mappings":"oJAMA,MAAMA,EAAY,CAAC,EASnB,SAASC,EAAUC,EAASC,GAO1B,MAAO,CACL,IACA,CAAC,IAAK,MARI,CAAC,OAAQ,EAAGD,EAASC,IAS/B,CAAC,IAAK,IARM,CAAC,OAAQ,EAAGD,EAASC,IASjC,CAAC,IAAK,IAAM,IARD,CAAC,OAAQ,EAAGD,EAASC,KAS/B,MAEL,CAIA,MAAMC,EAAK,CAAC,IAAK,EAAG,CAAC,eACfC,EAAM,CAAC,IAAK,CAAC,MAAO,QAASJ,GAAW,EAAG,IAE3CK,EAAO,CAAC,IAAK,CAAC,IADR,CAAC,IAAK,CAAC,MAAO,QAASL,EAAU,EAAG,IAClBI,GAAMD,GAC9BG,EAAM,CAAC,IAAK,CAAC,MAAO,QAASN,EAAU,GAAI,IAE3CO,EAAO,CAAC,IAAK,CAAC,IADR,CAAC,IAAK,CAAC,MAAO,QAASP,EAAU,EAAG,IAClBM,GAAMH,GAC9BK,EAAQ,CAAC,OAAQ,CAAC,OAAQ,CAAC,IAAK,CAAC,IAAKH,EAAM,GAAI,CAAC,IAAKE,EAAM,MAC5DE,EAAS,CAAC,QAAS,CAAC,OAAQ,CAAC,IAAK,EAAGJ,GAAOE,IAAQG,KAAKC,GAAID,KAAKC,IAClEC,EAAQ,CAAC,IAAKF,KAAKC,GAAK,IAAK,CAAC,MAAO,UAQrCE,EAAS,CAAC,IAAK,IALA,CACnB,IACA,CAAC,IAAK,CAAC,MAAOD,GAAQ,CAAC,MAAOJ,IAC9B,CAAC,IAAK,CAAC,MAAOI,GAAQ,CAAC,MAAOJ,GAAQ,CAAC,MAAO,CAAC,IALnC,CAAC,IAAKE,KAAKC,GAAK,IAAK,CAAC,MAAO,UAKkBF,OAIvDK,EAAe,IAAI,IAAU,CACjCC,QAAS,GACTC,OAAQ,IAAI,IAAU,CACpBC,IAAK,0EACLC,QAAS,GACTC,aACE,gIAEJC,MAAO,CACLrB,UAAWA,EACXsB,MAAO,CAAC,QAASR,MAIF,CAAC,OAAQ,QAAS,SAC1BS,SAAQ,SAAUC,GAC3B,MAAMC,EAAUC,SAASC,eAAeH,GAClCI,EAASF,SAASC,eAAeH,EAAK,OAC5C,SAASK,IACPD,EAAOE,UAAYL,EAAQM,MAC3B/B,EAAUwB,GAAMQ,OAAOP,EAAQM,MACjC,CACAF,IACAJ,EAAQQ,iBAAiB,SAAS,WAChCJ,IACAd,EAAamB,qBAAqBlC,EACpC,GACF,IAEY,IAAI,IAAI,CAClBmC,OAAQ,MACRC,OAAQ,CACN,IAAI,IAAU,CACZnB,OAAQ,IAAI,MAEdF,GAEFsB,KAAM,IAAI,KAAK,CACbC,OAAQ,EAAE,SAAU,SACpBC,KAAM,M","sources":["webpack:///./webgl-shaded-relief.js"],"sourcesContent":["import Map from '../src/ol/Map.js';\nimport View from '../src/ol/View.js';\nimport TileLayer from '../src/ol/layer/WebGLTile.js';\nimport ImageTile from '../src/ol/source/ImageTile.js';\nimport OSM from '../src/ol/source/OSM.js';\n\nconst variables = {};\n\n// The method used to extract elevations from the DEM.\n// In this case the format used is Terrarium\n// red * 256 + green + blue / 256 - 32768\n//\n// Other frequently used methods include the Mapbox format\n// (red * 256 * 256 + green * 256 + blue) * 0.1 - 10000\n//\nfunction elevation(xOffset, yOffset) {\n  const red = ['band', 1, xOffset, yOffset];\n  const green = ['band', 2, xOffset, yOffset];\n  const blue = ['band', 3, xOffset, yOffset];\n\n  // band math operates on normalized values from 0-1\n  // so we scale by 255\n  return [\n    '+',\n    ['*', 255 * 256, red],\n    ['*', 255, green],\n    ['*', 255 / 256, blue],\n    -32768,\n  ];\n}\n\n// Generates a shaded relief image given elevation data.  Uses a 3x3\n// neighborhood for determining slope and aspect.\nconst dp = ['*', 2, ['resolution']];\nconst z0x = ['*', ['var', 'vert'], elevation(-1, 0)];\nconst z1x = ['*', ['var', 'vert'], elevation(1, 0)];\nconst dzdx = ['/', ['-', z1x, z0x], dp];\nconst z0y = ['*', ['var', 'vert'], elevation(0, -1)];\nconst z1y = ['*', ['var', 'vert'], elevation(0, 1)];\nconst dzdy = ['/', ['-', z1y, z0y], dp];\nconst slope = ['atan', ['sqrt', ['+', ['^', dzdx, 2], ['^', dzdy, 2]]]];\nconst aspect = ['clamp', ['atan', ['-', 0, dzdx], dzdy], -Math.PI, Math.PI];\nconst sunEl = ['*', Math.PI / 180, ['var', 'sunEl']];\nconst sunAz = ['*', Math.PI / 180, ['var', 'sunAz']];\n\nconst cosIncidence = [\n  '+',\n  ['*', ['sin', sunEl], ['cos', slope]],\n  ['*', ['cos', sunEl], ['sin', slope], ['cos', ['-', sunAz, aspect]]],\n];\nconst scaled = ['*', 255, cosIncidence];\n\nconst shadedRelief = new TileLayer({\n  opacity: 0.3,\n  source: new ImageTile({\n    url: 'https://s3.amazonaws.com/elevation-tiles-prod/terrarium/{z}/{x}/{y}.png',\n    maxZoom: 15,\n    attributions:\n      '<a href=\"https://github.com/tilezen/joerd/blob/master/docs/attribution.md\" target=\"_blank\">Data sources and attribution</a>',\n  }),\n  style: {\n    variables: variables,\n    color: ['color', scaled],\n  },\n});\n\nconst controlIds = ['vert', 'sunEl', 'sunAz'];\ncontrolIds.forEach(function (id) {\n  const control = document.getElementById(id);\n  const output = document.getElementById(id + 'Out');\n  function updateValues() {\n    output.innerText = control.value;\n    variables[id] = Number(control.value);\n  }\n  updateValues();\n  control.addEventListener('input', function () {\n    updateValues();\n    shadedRelief.updateStyleVariables(variables);\n  });\n});\n\nconst map = new Map({\n  target: 'map',\n  layers: [\n    new TileLayer({\n      source: new OSM(),\n    }),\n    shadedRelief,\n  ],\n  view: new View({\n    center: [-13615645, 4497969],\n    zoom: 13,\n  }),\n});\n"],"names":["variables","elevation","xOffset","yOffset","dp","z0x","dzdx","z0y","dzdy","slope","aspect","Math","PI","sunEl","scaled","shadedRelief","opacity","source","url","maxZoom","attributions","style","color","forEach","id","control","document","getElementById","output","updateValues","innerText","value","Number","addEventListener","updateStyleVariables","target","layers","view","center","zoom"],"sourceRoot":""}